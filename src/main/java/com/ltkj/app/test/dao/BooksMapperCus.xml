<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ltkj.app.test.dao.BooksMapperCus" >
  <resultMap id="BaseResultMap" type="com.ltkj.app.test.model.BooksCus" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <result column="uuid" property="uuid" jdbcType="VARCHAR" />
    <result column="book_number" property="bookNumber" jdbcType="VARCHAR" />
    <result column="book_name" property="bookName" jdbcType="VARCHAR" />
    <result column="book_sort" property="bookSort" jdbcType="CHAR" />
    <result column="book_sort_info" property="bookSortInfo" jdbcType="VARCHAR" />
    <result column="book_author" property="bookAuthor" jdbcType="VARCHAR" />
    <result column="book_price" property="bookPrice" jdbcType="DECIMAL" />
    <result column="book_discount" property="bookDiscount" jdbcType="INTEGER" />
    <result column="book_desc" property="bookDesc" jdbcType="VARCHAR" />
    <result column="descriptiondis" property="descriptiondis" jdbcType="VARCHAR" />
    <result column="is_active" property="isActive" jdbcType="VARCHAR" />
    <result column="create_dt" property="createDt" jdbcType="TIMESTAMP" />
    <result column="create_op" property="createOp" jdbcType="VARCHAR" />
    <result column="create_pg" property="createPg" jdbcType="VARCHAR" />
    <result column="update_dt" property="updateDt" jdbcType="TIMESTAMP" />
    <result column="update_op" property="updateOp" jdbcType="VARCHAR" />
    <result column="update_pg" property="updatePg" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    	BOOKS.UUID,
  		BOOKS.BOOK_NUMBER,
  		BOOKS.BOOK_NAME,
  		BOOKS.BOOK_SORT,
  		BOOKS.BOOK_AUTHOR,
  		BOOKS.BOOK_PRICE,
  		BOOKS.BOOK_DISCOUNT,
  		IF(
			LENGTH(BOOKS.BOOK_DESC)>10, 
			CONCAT(LEFT(BOOKS.BOOK_DESC,6),'...'),
			BOOKS.BOOK_DESC) 
		AS DESCRIPTIONDIS,
  		BOOKS.BOOK_DESC,
  		HM.VALUE book_sort_info
  </sql> 
  <!-- 查询图书列表 -->
  <select id="selectBooksList" resultMap="BaseResultMap" parameterType="BooksCus">
	  	SELECT
	  		<include refid="Base_Column_List"/>
	  	FROM ZWY_BOOKS BOOKS LEFT JOIN M_HASH_MAP HM
	         ON  (BOOKS.BOOK_SORT = HM.KEY
	         AND HM.TYPE_NAME = 'book_sort')
         <where>
         	  IS_ACTIVE='1'
              <if test="bookNumber != null and bookNumber !=''">
		        and BOOKS.BOOK_NUMBER like CONCAT('%', #{bookNumber,jdbcType=VARCHAR}, '%')
		      </if>
		      <if test="bookName != null and bookName !=''">
		        and BOOKS.BOOK_NAME like CONCAT('%', #{bookName,jdbcType=VARCHAR}, '%') 
		      </if>		     
		      <if test="bookSort != null and bookSort !=''">
		        and BOOKS.BOOK_SORT = #{bookSort,jdbcType=CHAR}
		      </if>
		      <if test="bookAuthor != null and bookAuthor !=''">
		        and BOOKS.BOOK_AUTHOR = #{bookAuthor,jdbcType=VARCHAR}
		      </if>
		      <if test="bookPrice != null and bookPrice !=''">
		        and BOOKS.BOOK_PRICE = #{bookPrice,jdbcType=DECIMAL}
		      </if>
		      <if test="bookDiscount != null and bookDiscount !=''">
		        and BOOKS.BOOK_DISCOUNT = #{bookDiscount,jdbcType=INTEGER}
		      </if>
		      <if test="bookDesc != null and bookDesc !=''">
		        and BOOKS.BOOK_DESC = #{bookDesc,jdbcType=VARCHAR}
		      </if>		      
		      <if test="isActive != null and isActive !=''">
		        and BOOKS.IS_ACTIVE = #{isActive,jdbcType=VARCHAR}
		      </if>
		      <if test="createDt != null and createDt !=''">
		        and BOOKS.CREATE_DT = #{createDt,jdbcType=TIMESTAMP}
		      </if>
		      <if test="createOp != null and createOp !=''">
		        and BOOKS.CREATE_OP = #{createOp,jdbcType=VARCHAR}
		      </if>
		      <if test="createPg != null and createPg !=''">
		        and BOOKS.CREATE_PG = #{createPg,jdbcType=VARCHAR}
		      </if>
		      <if test="updateDt != null and updateDt !=''">
		        and BOOKS.UPDATE_DT = #{updateDt,jdbcType=TIMESTAMP}
		      </if>
		      <if test="updateOp != null and updateOp !=''">
		        and BOOKS.UPDATE_OP = #{updateOp,jdbcType=VARCHAR}
		      </if>
		      <if test="updatePg != null and updatePg !=''">
		        and BOOKS.UPDATE_PG = #{updatePg,jdbcType=VARCHAR}
		      </if>
        </where>
        ORDER BY BOOKS.BOOK_NUMBER
  </select>
  
  <!-- 通过id查询图书信息编辑用 -->
  <select id="selectBookById" resultMap="BaseResultMap" parameterType="BooksCus">
	  	SELECT
	  		<include refid="Base_Column_List"/>
	  	FROM ZWY_BOOKS BOOKS LEFT JOIN M_HASH_MAP HM
	         ON  (BOOKS.BOOK_SORT = HM.KEY
	         AND HM.TYPE_NAME = 'book_sort')
  		<where>
              <if test="uuid != null and uuid !=''">
                and BOOKS.UUID = #{uuid,jdbcType=VARCHAR}
              </if>
        </where>  
  </select> 
  
  <!-- 通过id删除图书信息(逻辑删除) -->
  <update id="deleteBooksByIds" parameterType="java.util.List">
  		UPDATE ZWY_BOOKS SET IS_ACTIVE='0'
		WHERE UUID IN
		 <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
		 	#{item}
		 </foreach>
  </update>
  
  <!-- 根据图书编号，获取当前图书个数 -->
	<select id="checkBookNumber" resultType="int" parameterType="BooksCus">
		SELECT 
		 	COUNT(1)
		FROM ZWY_BOOKS 
		WHERE UUID &lt;&gt; #{uuid} AND BOOK_NUMBER = #{fieldValue}
	</select>
</mapper>