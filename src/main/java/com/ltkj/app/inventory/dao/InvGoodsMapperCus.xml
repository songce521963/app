<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ltkj.app.inventory.dao.InvGoodsMapperCus">
	<resultMap id="BaseResultMap"
		type="com.ltkj.app.inventory.model.InvGoodsDetailModel">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<id column="goods_id" jdbcType="VARCHAR" property="goodsId" />
		<result column="goods_name" jdbcType="VARCHAR" property="goodsName" />
		<result column="batch_code" jdbcType="VARCHAR" property="batchCode" />
		<result column="spec" jdbcType="VARCHAR" property="spec" />
		<result column="primary_category" jdbcType="CHAR" property="primaryCategory" />
		<result column="small_category" jdbcType="CHAR" property="smallCategory" />
		<result column="primary_category_info" jdbcType="VARCHAR"
			property="primaryCategoryInfo" />
		<result column="small_category_info" jdbcType="VARCHAR"
			property="smallCategoryInfo" />
		<result column="weight" jdbcType="DECIMAL" property="weight" />
		<result column="pic_src" jdbcType="VARCHAR" property="picSrc" />
		<result column="description" jdbcType="VARCHAR" property="description" />
		<result column="buying_price" jdbcType="DECIMAL" property="buyingPrice" />
		<result column="selling_price1" jdbcType="DECIMAL" property="sellingPrice1" />
		<result column="selling_price2" jdbcType="DECIMAL" property="sellingPrice2" />
		<result column="selling_price3" jdbcType="DECIMAL" property="sellingPrice3" />
		<result column="discount" jdbcType="INTEGER" property="discount" />
		<result column="quantity" jdbcType="INTEGER" property="quantity" />
		<result column="replenish" jdbcType="INTEGER" property="replenish" />
		<result column="key_cd" jdbcType="VARCHAR" property="keyCd" />
		<result column="Is_Active" jdbcType="VARCHAR" property="isActive" />
		<result column="CREATE_DT" jdbcType="TIMESTAMP" property="createDt" />
		<result column="CREATE_OP" jdbcType="VARCHAR" property="createOp" />
		<result column="CREATE_PG" jdbcType="VARCHAR" property="createPg" />
		<result column="UPDATE_DT" jdbcType="TIMESTAMP" property="updateDt" />
		<result column="UPDATE_OP" jdbcType="VARCHAR" property="updateOp" />
		<result column="UPDATE_PG" jdbcType="VARCHAR" property="updatePg" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		GOODS.goods_id,
		GOODS.goods_name,
		GOODS.batch_code,
		GOODS.spec,
		GOODS.primary_category,
		GOODS.small_category,
		GOODS.weight,
		GOODS.pic_src,
		GOODS.description,
		GOODS.buying_price,
		GOODS.selling_price1,
		GOODS.selling_price2,
		GOODS.selling_price3,
		GOODS.discount,
		GOODS.quantity,
		GOODS.replenish,
		GOODS.key_cd,
		GOODS.Is_Active,
		GOODS.CREATE_DT,
		GOODS.CREATE_OP,
		GOODS.CREATE_PG,
		GOODS.UPDATE_DT,
		GOODS.UPDATE_OP,
		GOODS.UPDATE_PG,
		HM.VALUE primary_category_info,
		HH.VALUE small_category_info
	</sql>
	<select id="queryGoodsList" resultMap="BaseResultMap"
		parameterType="InvGoodsDetailModel">
		SELECT
		<include refid="Base_Column_List" />
		FROM
		S_GOODS GOODS LEFT JOIN M_HASH_MAP HM
		ON (GOODS.PRIMARY_CATEGORY = HM.KEY
		AND HM.TYPE_NAME = 'goods_primary_category')
		LEFT JOIN M_HASH_MAP HH
		ON (GOODS.SMALL_CATEGORY = HH.KEY
		AND HH.TYPE_NAME = 'goods_small_category')
		<where>
			<if test="goodsName != null and goodsName !=''">
				and GOODS.goods_name like CONCAT('%', #{goodsName,jdbcType=VARCHAR},
				'%')
			</if>
			<if test="batchCode != null and batchCode !=''">
				and GOODS.batch_code like CONCAT('%', #{batchCode,jdbcType=VARCHAR},
				'%')
			</if>
			<if test="spec != null and spec !=''">
				and GOODS.spec like CONCAT('%', #{spec,jdbcType=VARCHAR}, '%')
			</if>
			<if test="primaryCategory != null and primaryCategory !=''">
				and GOODS.primary_category = #{primaryCategory,jdbcType=CHAR}
			</if>
			<if test="smallCategory != null and smallCategory !=''">
				and GOODS.small_category = #{smallCategory,jdbcType=CHAR}
			</if>
			<if test="weight != null and weight !=''">
				and GOODS.weight = #{weight,jdbcType=DECIMAL}
			</if>
			<if test="description != null and description !=''">
				and GOODS.description = #{description,jdbcType=VARCHAR}
			</if>
			<if test="buyingPrice != null and buyingPrice !=''">
				and GOODS.buying_price = #{buyingPrice,jdbcType=INTEGER}
			</if>
			<if test="sellingPrice1 != null and sellingPrice1 !=''">
				and GOODS.selling_price1 = #{sellingPrice1,jdbcType=INTEGER}
			</if>
			<if test="sellingPrice2 != null and sellingPrice2 !=''">
				and GOODS.selling_price2 = #{sellingPrice2,jdbcType=INTEGER}
			</if>
			<if test="sellingPrice3 != null and sellingPrice3 !=''">
				and GOODS.selling_price3 = #{sellingPrice3,jdbcType=INTEGER}
			</if>
			<if test="discount != null and discount !=''">
				and GOODS.discount = #{discount,jdbcType=INTEGER}
			</if>
			<if test="quantity != null and quantity !=''">
				and GOODS.quantity = #{quantity,jdbcType=INTEGER}
			</if>
			<if test="keyCd != null and keyCd !=''">
				and GOODS.key_cd = #{keyCd,jdbcType=VARCHAR}
			</if>
			<!-- <if test="true"> -->
			<!-- and GOODS.Is_Active = '1' -->
			<!-- </if> -->
			<if test="createDt != null and createDt !=''">
				and GOODS.CREATE_DT = #{createDt,jdbcType=TIMESTAMP}
			</if>
			<if test="createOp != null and createOp !=''">
				and GOODS.CREATE_OP = #{createOp,jdbcType=VARCHAR}
			</if>
			<if test="createPg != null and createPg !=''">
				and GOODS.CREATE_PG = #{createPg,jdbcType=VARCHAR}
			</if>
			<if test="updateDt != null and updateDt !=''">
				and GOODS.UPDATE_DT = #{updateDt,jdbcType=TIMESTAMP}
			</if>
			<if test="updateOp != null and updateOp !=''">
				and GOODS.UPDATE_OP = #{updateOp,jdbcType=VARCHAR}
			</if>
			<if test="updatePg != null and updatePg !=''">
				and GOODS.UPDATE_PG = #{updatePg,jdbcType=VARCHAR}
			</if>
			<if test="companyId != null and companyId != ''">
				and COMPANY_ID = #{companyId}
			</if>
			<if test="checkCount == true">
				and GOODS.quantity &lt; GOODS.replenish
			</if>
		</where>
		ORDER BY CREATE_DT DESC
	</select>

	<select id="queryGoods" resultMap="BaseResultMap" parameterType="Goods">
		SELECT
		<include refid="Base_Column_List" />
		FROM
		S_GOODS GOODS LEFT JOIN M_HASH_MAP HM
		ON (GOODS.PRIMARY_CATEGORY = HM.KEY
		AND HM.TYPE_NAME = 'goods_primary_category')
		LEFT JOIN M_HASH_MAP HH
		ON (GOODS.SMALL_CATEGORY = HH.KEY
		AND HH.TYPE_NAME = 'goods_small_category')
		<where>
			<if test="goodsId != null and goodsId !=''">
				and GOODS.goods_id = #{goodsId,jdbcType=VARCHAR}
			</if>
		</where>
	</select>

	<!-- 商品下架 -->
	<delete id="deleteGoodsByIds">
		UPDATE S_GOODS
		SET IS_ACTIVE = '0',
		UPDATE_DT = NOW(),
		UPDATE_OP = #{userId},
		UPDATE_PG = #{userName}
		WHERE GOODS_ID IN
		<foreach collection="list" index="index" item="item" open="("
			separator="," close=")">
			#{item}
		</foreach>
	</delete>

	<!-- 商品重新上架 -->
	<update id="recoveryGoodsByGoodsId" parameterType="Goods">
		UPDATE
		S_GOODS
		SET IS_ACTIVE='1'
		WHERE GOODS_ID =#{goodsId}
	</update>

	<delete id="deleteGoodsPhyByIds">
		DELETE FROM S_GOODS
		WHERE GOODS_ID IN
		<foreach collection="list" index="index" item="item" open="("
			separator="," close=")">
			#{item}
		</foreach>
	</delete>

	<select id="selectGoodsByIds" resultMap="BaseResultMap">
		SELECT *
		FROM S_GOODS
		WHERE GOODS_ID IN
		<foreach collection="list" index="index" item="item" open="("
			separator="," close=")">
			#{item}
		</foreach>
	</select>

	<select id="selectGoodsCount" resultType="int">
		SELECT COUNT(1)
		FROM S_ORDER ORDE
		WHERE ORDE.`STATUS`='01' AND ORDE.IS_ACTIVE='1' AND ORDE.ORDER_ID IN (SELECT
		DETAIL.ORDER_ID
		FROM S_ORDER_DETAIL DETAIL
		WHERE DETAIL.GOODS_ID IN 
		<foreach collection="list" index="index" item="item" open="("
			separator="," close=")">
			#{item}
		</foreach>)
	</select>
	
<!-- 	查看商品详细前check在数据中是否存在 -->
	<select id="queryGoodsIsExist" parameterType="Goods" resultType="int">
		SELECT
		COUNT(*)
		FROM S_GOODS GOODS
		WHERE GOODS.GOODS_ID=#{goodsId}
	</select>

</mapper>